:root{
  --bg:radial-gradient(1200px 800px at 15% 10%, rgba(14,165,233,0.14), rgba(14,165,233,0) 55%),
       radial-gradient(1000px 700px at 85% 90%, rgba(56,189,248,0.16), rgba(56,189,248,0) 55%),
       linear-gradient(180deg,#f8fbff 0%, #eef3f8 100%);
  --panel:transparent;
  --muted:#475569;
  --text:#0f172a;
  --primary:#0ea5e9;
  --primary-700:#0284c7;
  --danger:#ef4444;
  --success:#16a34a;
  --border:rgba(2,6,23,0.08);
  --glass-bg:rgba(255,255,255,0.62);
  --glass-bg-strong:rgba(255,255,255,0.75);
  --glass-border:rgba(255,255,255,0.38);
  --shadow:0 10px 30px rgba(2,6,23,0.10);
  /* iOS-like shape and sizing */
  --radius:14px;
  --radius-lg:18px;
  --button-height:44px; /* iOS 觸控高度 */
  --button-px:14px;
  --glass-blur:18px;
  --glass-sat:180%;
  --glass-highlight:rgba(255,255,255,0.65);
  --glass-innerline:rgba(255,255,255,0.25);
}

@media (prefers-color-scheme: dark){
  :root{
    --bg:radial-gradient(1200px 800px at 15% 10%, rgba(56,189,248,0.10), rgba(56,189,248,0) 55%),
         radial-gradient(1000px 700px at 85% 90%, rgba(14,165,233,0.12), rgba(14,165,233,0) 55%),
         linear-gradient(180deg,#0b1220 0%, #0a0f1a 100%);
    --panel:transparent;
    --muted:#94a3b8;
    --text:#e2e8f0;
    --primary:#38bdf8;
    --primary-700:#0ea5e9;
    --danger:#f87171;
    --success:#22c55e;
    --border:rgba(148,163,184,0.18);
    --glass-bg:rgba(15,23,42,0.55);
    --glass-bg-strong:rgba(15,23,42,0.72);
    --glass-border:rgba(148,163,184,0.28);
    --shadow:0 10px 30px rgba(2,6,23,0.40);
    --glass-blur:20px;
    --glass-sat:180%;
    --glass-highlight:rgba(255,255,255,0.5);
    --glass-innerline:rgba(255,255,255,0.18);
  }
}
/* Explicit themes override (user setting) */
.theme-light{
  --bg:linear-gradient(180deg,#f8fbff 0%, #eef3f8 100%);
  --text:#0f172a; --muted:#475569; --primary:#0ea5e9; --primary-700:#0284c7; --border:rgba(2,6,23,0.08);
  --glass-bg:rgba(255,255,255,0.62); --glass-bg-strong:rgba(255,255,255,0.78); --glass-border:rgba(2,6,23,0.08); --shadow:0 10px 30px rgba(2,6,23,0.10);
  --glass-blur:18px; --glass-sat:180%; --glass-highlight:rgba(255,255,255,0.70); --glass-innerline:rgba(255,255,255,0.28);
}
.theme-dark{
  --bg:radial-gradient(1200px 800px at 15% 10%, rgba(56,189,248,0.10), rgba(56,189,248,0) 55%),
       radial-gradient(1000px 700px at 85% 90%, rgba(14,165,233,0.12), rgba(14,165,233,0) 55%),
       linear-gradient(180deg,#0b1220 0%, #0a0f1a 100%);
  --text:#e2e8f0; --muted:#94a3b8; --primary:#38bdf8; --primary-700:#0ea5e9; --border:rgba(148,163,184,0.18);
  --glass-bg:rgba(15,23,42,0.55); --glass-bg-strong:rgba(15,23,42,0.72); --glass-border:rgba(148,163,184,0.28); --shadow:0 10px 30px rgba(2,6,23,0.40);
}
.theme-oled{
  --bg:#000000;
  --text:#e5e7eb; --muted:#94a3b8; --primary:#3abff8; --primary-700:#0ea5e9; --border:rgba(148,163,184,0.18);
  --glass-bg:rgba(255,255,255,0.06); --glass-bg-strong:rgba(255,255,255,0.08); --glass-border:rgba(255,255,255,0.14); --shadow:0 12px 28px rgba(0,0,0,0.6);
  --glass-highlight:rgba(255,255,255,0.4);
  --glass-innerline:rgba(255,255,255,0.12);
}

/* OLED: top and bottom bars pure black with subtle separators */
.theme-oled .app-header,
.theme-oled .app-footer,
.theme-oled .tabs{
  background:#000000;
  border-color:rgba(255,255,255,0.08);
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";scroll-behavior:smooth;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-tap-highlight-color:transparent}
@media (min-resolution: 120dpi), (min-resolution: 2dppx){
  /* 提示有高更新率螢幕（類似 ProMotion）時，啟用更流暢的過渡時間參數 */
  :root{ --motion-fast: .06s; --motion: .16s; --motion-slow: .22s }
}
@media (max-resolution: 119dpi){ :root{ --motion-fast: .08s; --motion: .22s; --motion-slow: .28s } }
@supports (-webkit-overflow-scrolling: touch){ :root{ --motion: .18s } }
.app-header h1{font-size:28px;font-weight:700;letter-spacing:-0.02em}
.app-header,.app-footer{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--glass-border);background:var(--glass-bg-strong);backdrop-filter:saturate(var(--glass-sat)) blur(var(--glass-blur));-webkit-backdrop-filter:saturate(var(--glass-sat)) blur(var(--glass-blur));box-shadow:var(--shadow);position:relative}
.app-header::before,.app-footer::before{content:"";position:absolute;inset:0;border-radius:inherit;pointer-events:none;background:linear-gradient(180deg,var(--glass-highlight),transparent 40%);opacity:.35}
.app-header::after,.app-footer::after{content:"";position:absolute;inset:0;border-radius:inherit;pointer-events:none;box-shadow:inset 0 1px 0 var(--glass-innerline)}
.app-footer{border-top:1px solid var(--border);border-bottom:0;justify-content:center;position:fixed;left:0;right:0;bottom:env(safe-area-inset-bottom);z-index:40;padding:8px 16px;background:transparent;pointer-events:none}
.container{max-width:960px;margin:16px auto;padding:0 12px;display:grid;gap:16px}
.card{background:var(--glass-bg);border:1px solid var(--glass-border);border-radius:var(--radius-lg);padding:16px;box-shadow:var(--shadow);backdrop-filter:saturate(var(--glass-sat)) blur(var(--glass-blur));-webkit-backdrop-filter:saturate(var(--glass-sat)) blur(var(--glass-blur));position:relative}
.card{will-change:transform}
.card::before{content:"";position:absolute;inset:0;border-radius:inherit;pointer-events:none;background:linear-gradient(180deg,var(--glass-highlight),transparent 35%);opacity:.28}
.card::after{content:"";position:absolute;inset:0;border-radius:inherit;pointer-events:none;box-shadow:inset 0 1px 0 var(--glass-innerline)}
h1,h2,h3{margin:0 0 12px}
h2{font-size:18px;font-weight:600}
.header-actions{display:flex;gap:8px}
button{appearance:none;-webkit-appearance:none;background:transparent;color:var(--text);border:1px solid transparent;border-radius:9999px;height:var(--button-height);padding:0 var(--button-px);cursor:pointer;display:inline-flex;align-items:center;gap:8px;justify-content:center;font-weight:600;letter-spacing:0.01em;backdrop-filter:blur(10px) saturate(140%);-webkit-backdrop-filter:blur(10px) saturate(140%);transition:transform var(--motion-fast, .06s) ease, box-shadow var(--motion, .2s) ease, border-color var(--motion, .2s) ease, background-color var(--motion, .2s) ease}
button{will-change:transform}
button:hover{box-shadow:0 6px 16px rgba(14,165,233,0.18)}
button:active{transform:translateY(1px)}
button:focus-visible{outline:2px solid rgba(14,165,233,0.5);outline-offset:2px}
/* Filled (Primary) */
.primary{background:linear-gradient(180deg, rgba(14,165,233,0.98), rgba(2,132,199,0.98));color:#ffffff;border:1px solid rgba(255,255,255,0.28);box-shadow:0 6px 16px rgba(14,165,233,0.25)}
.primary:hover{background:linear-gradient(180deg, rgba(14,165,233,1), rgba(2,132,199,1))}
.primary:active{box-shadow:0 2px 8px rgba(14,165,233,0.25)}
/* Tinted (Secondary) */
.secondary{background:rgba(14,165,233,0.12);color:var(--text);border:1px solid rgba(14,165,233,0.45)}
.secondary:hover{background:rgba(14,165,233,0.18)}
/* Plain/Glass (Ghost) */
.ghost{background:rgba(255,255,255,0.6);color:var(--text);border:1px solid var(--glass-border)}
.ghost:hover{border-color:var(--primary)}
/* Destructive */
button.danger{background:rgba(255,255,255,0.6);color:#b91c1c;border:1px solid rgba(239,68,68,0.5)}
button.danger:hover{border-color:#ef4444;box-shadow:0 6px 16px rgba(239,68,68,0.18)}
.field{display:flex;flex-direction:column;gap:6px}
.field--full{grid-column:1/-1}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
@media (max-width:720px){.grid{grid-template-columns:1fr 1fr}.field--full{grid-column:1/3}}
label{font-size:12px;color:var(--muted)}
input,select{background:rgba(255,255,255,0.6);color:var(--text);border:1px solid var(--glass-border);border-radius:var(--radius);padding:10px;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px)}
select{appearance:none;-webkit-appearance:none;padding-right:36px;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="%235b6574" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>');background-repeat:no-repeat;background-position:right 10px center;background-size:20px}
input:focus-visible,select:focus-visible{outline:2px solid rgba(14,165,233,0.45);outline-offset:2px}
input::placeholder{color:#5b6574}
.form-actions button{min-width:88px}
.form-actions{display:flex;gap:8px;margin-top:12px}
.inline{display:flex;gap:8px;align-items:center}
.summary{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.summary .label{display:block;color:var(--muted);font-size:12px;margin-bottom:4px}
.summary span[id^="summary"]{font-weight:600}
.list-header{display:flex;align-items:center;justify-content:space-between;gap:12px}
.filters{display:flex;gap:8px}
.tx-list{list-style:none;margin:0;padding:0}
.tx-list{-webkit-overflow-scrolling:touch}
.tx-item{display:grid;grid-template-columns:1fr auto auto;gap:12px;align-items:center;padding:12px;border-top:1px solid var(--glass-border)}
.tx-item:first-child{border-top:0}
.tx-amount{font-variant-numeric:tabular-nums}
.tx-amount.income{color:var(--success)}
.tx-amount.expense{color:var(--danger)}
.tx-actions{display:flex;gap:6px}
.emotion{opacity:0.9;font-size:12px;color:var(--muted)}

dialog{border:1px solid var(--glass-border);background:var(--glass-bg-strong);color:var(--text);border-radius:18px;padding:16px;box-shadow:var(--shadow);backdrop-filter:blur(18px);-webkit-backdrop-filter:blur(18px)}
.category-form{max-width:720px;width:92vw}
.category-form{min-width:320px}
.category-list{list-style:none;margin:12px 0 0;padding:0;max-height:240px;overflow:auto;border-top:1px solid var(--border)}
.category-item{display:flex;align-items:center;justify-content:space-between;padding:10px;border-bottom:1px solid var(--border)}
.category-list input[type="number"]{width:120px}
.dialog-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:12px}

.badge{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--glass-border);background:rgba(255,255,255,0.6);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);border-radius:999px;padding:2px 8px;font-size:12px;color:var(--muted)}
.badge.success{color:#10b981;border-color:#10b98133;background:#10b98114}
.badge.pending{color:#f59e0b;border-color:#f59e0b33;background:#f59e0b14}
.chart{height:200px;display:grid;align-items:end;gap:6px;grid-auto-flow:column;border-top:1px dashed var(--glass-border);padding-top:12px;overflow-x:hidden}
@media (max-width:560px){ .chart{ grid-auto-flow:row; height:auto; } }
.bar{background:linear-gradient(180deg,#22d3ee,#0ea5e9);border-radius:6px;min-width:10px}
.chart .bar.negative{background:linear-gradient(180deg,#fca5a5,#ef4444)}
/* donut */
.donut{position:relative;width:220px;height:220px;border-radius:50%;background:
  conic-gradient(var(--seg1,#0ea5e9) 0 var(--p1,0%), var(--seg2,#38bdf8) var(--p1,0%) var(--p2,0%), var(--seg3,#7dd3fc) var(--p2,0%) var(--p3,0%), var(--seg4,#93c5fd) var(--p3,0%) 100%),
  radial-gradient(circle at center, transparent 58%, rgba(255,255,255,0.8) 59%);
  box-shadow:var(--shadow);
}
.donut-legend{display:grid;gap:6px;margin-top:8px}
.legend-item{display:flex;align-items:center;gap:8px}
.legend-dot{width:10px;height:10px;border-radius:50%}

.calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
#calendarGrid{-webkit-overflow-scrolling:touch}
@media (max-width:560px){
  #calendarGrid{overflow-x:hidden}
  .calendar{grid-template-columns:repeat(7, minmax(40px, 1fr))}
  .cal-cell{min-height:64px}
}
.cal-cell{border:1px solid var(--glass-border);border-radius:12px;min-height:72px;padding:6px;background:rgba(255,255,255,0.6);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px)}
.cal-cell .day{font-size:12px;color:var(--muted)}
.cal-cell .sum{margin-top:6px;font-weight:600}
.cal-cell.income .sum{color:var(--success)}
.cal-cell.expense .sum{color:var(--danger)}
.cal-cell.today{outline:1px solid var(--primary)}
.cal-cellbutton{appearance:none;background:transparent;border:0;padding:0;width:100%;text-align:left;color:inherit;cursor:pointer}

.assistant .assistant-row{display:flex;gap:12px;align-items:flex-start;margin-top:12px;flex-wrap:wrap}
.assistant .chips{display:flex;gap:8px;flex-wrap:wrap}
.chip{border:1px solid var(--glass-border);background:rgba(255,255,255,0.6);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);border-radius:999px;padding:2px 10px;font-size:12px;cursor:pointer}
.insights{list-style:disc;margin:0;padding-left:20px;color:var(--muted)}

/* AI streaming answer (iOS-like typography) */
#aiAnswer{font-size:15px;line-height:1.6;letter-spacing:0.2px;white-space:pre-wrap;word-break:break-word}
#aiAnswer{-webkit-overflow-scrolling:touch}
.ai-typing{display:inline-flex;gap:6px;align-items:center;padding:4px 0}
.ai-typing i{width:6px;height:6px;border-radius:9999px;background:var(--muted);opacity:.5;animation:ai-dot 1s infinite ease-in-out}
.ai-typing i:nth-child(2){animation-delay:.15s}
.ai-typing i:nth-child(3){animation-delay:.3s}
@keyframes ai-dot{0%,80%,100%{transform:translateY(0);opacity:.5}40%{transform:translateY(-4px);opacity:1}}

/* Advanced fields hidden by default */
.adv{display:none}
.advanced-on .adv{display:flex}

.tabs{display:flex;gap:8px;margin-bottom:8px}
.tabs{display:inline-flex;align-items:center;border:1px solid var(--glass-border);background:var(--glass-bg-strong);border-radius:9999px;padding:4px;gap:4px;backdrop-filter:saturate(var(--glass-sat)) blur(calc(var(--glass-blur) - 6px));-webkit-backdrop-filter:saturate(var(--glass-sat)) blur(calc(var(--glass-blur) - 6px));position:relative;overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch;scroll-snap-type:x mandatory}
.tabs::before{content:"";position:absolute;inset:0;border-radius:inherit;pointer-events:none;background:linear-gradient(180deg,var(--glass-highlight),transparent 40%);opacity:.28}
.tabs::after{content:"";position:absolute;inset:0;border-radius:inherit;pointer-events:none;box-shadow:inset 0 1px 0 var(--glass-innerline)}
.tabs .indicator{position:absolute;top:4px;bottom:4px;width:calc(25% - 8px); /* 將被 JS 覆寫為實際按鈕寬度 */ background:rgba(255,255,255,0.55);border:1px solid var(--glass-border);border-radius:9999px;transition:transform var(--motion, .18s) ease, width var(--motion, .18s) ease;will-change:transform,width;box-shadow:inset 0 0 0 0.5px rgba(255,255,255,0.6), 0 4px 12px rgba(14,165,233,0.16);pointer-events:none}
.tab-btn{background:transparent;border:0;border-radius:9999px;padding:10px 14px;cursor:pointer;color:var(--text);height:42px;min-width:76px;font-weight:600;flex:0 0 auto;scroll-snap-align:center}
.tab-btn.active{background:rgba(255,255,255,0.9);border:1px solid var(--glass-border);box-shadow:inset 0 0 0 0.5px rgba(255,255,255,0.6), 0 6px 16px rgba(14,165,233,0.18);color:#0b4a6f;transition:background var(--motion, .18s) ease, color var(--motion, .18s) ease}

/* Import label styled as button */
.import-label span{display:inline-flex;align-items:center;gap:6px;background:rgba(255,255,255,0.6);color:var(--text);border:1px solid var(--glass-border);border-radius:12px;padding:8px 12px;cursor:pointer;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px)}
.import-label span:hover{border-color:var(--primary)}
[data-tab]{display:block;transition:opacity var(--motion, .18s) ease, transform var(--motion-slow, .22s) ease;will-change:opacity,transform}
.hidden{display:none !important}

/* Notices */
.notice{margin:12px auto;max-width:960px;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 14px;border-radius:14px;border:1px solid var(--glass-border);background:rgba(255,245,235,0.6);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);box-shadow:var(--shadow)}
.notice--warn{border-color:#f59e0b33;background:rgba(245,158,11,0.08)}
.notice__content{font-size:14px;color:#92400e}
.notice__actions{display:flex;gap:8px}

/* Bottom Tab Bar (iOS style) */
.app-footer + .tabs, .tabs.bottom{
  position:fixed;
  left:50%;
  transform:translateX(-50%);
  bottom:calc(env(safe-area-inset-bottom) + 48px);
  z-index:50;
}
@supports (padding: max(0px)){
  .tabs.bottom{ bottom: max(64px, env(safe-area-inset-bottom)); }
}
/* Ensure content not hidden by bottom tabs */
main.container{ padding-bottom: calc(140px + env(safe-area-inset-bottom)); }

/* Lift footer text above fixed bottom tabs */
.app-footer{ padding-bottom: 8px; }

/* iOS-style Switch for all checkboxes */
input[type="checkbox"]{
  -webkit-appearance:none;
  appearance:none;
  position:relative;
  width:52px;
  height:32px;
  border-radius:9999px;
  background:#e5e7eb;
  border:1px solid var(--glass-border);
  transition:background .2s ease, border-color .2s ease;
  cursor:pointer;
}
@media (prefers-color-scheme: dark){
  input[type="checkbox"]{ background:rgba(255,255,255,0.12); }
}
input[type="checkbox"]::after{
  content:"";
  position:absolute;
  top:2px;
  left:2px;
  width:28px;
  height:28px;
  border-radius:9999px;
  background:#ffffff;
  box-shadow:0 1px 2px rgba(0,0,0,0.15), 0 3px 8px rgba(0,0,0,0.08);
  transition:transform .2s ease;
}
@media (prefers-color-scheme: dark){
  input[type="checkbox"]::after{ background:#e2e8f0; }
}
input[type="checkbox"]:checked{
  background:var(--primary);
  border-color:rgba(255,255,255,0.4);
}
input[type="checkbox"]:checked::after{ transform:translateX(20px); }
input[type="checkbox"]:focus-visible{ outline:2px solid rgba(14,165,233,0.5); outline-offset:2px }

/* FAB */
.fab{position:fixed;right:16px;bottom:calc(96px + env(safe-area-inset-bottom));width:56px;height:56px;border-radius:9999px;display:inline-flex;align-items:center;justify-content:center;font-size:28px;line-height:1;border:0;z-index:80}
@media (max-width:720px){ .fab{ right:12px; bottom:calc(88px + env(safe-area-inset-bottom)); } }
.fab .icon{transform:translateY(-1px)}

/* Quick form */
.quick-form{min-width:320px}
.segmented{display:inline-flex;gap:6px;border:1px solid var(--glass-border);background:var(--glass-bg-strong);border-radius:9999px;padding:4px}
.seg-btn{background:transparent;border:0;border-radius:9999px;padding:8px 12px;cursor:pointer;color:var(--text);height:36px;font-weight:600}
.seg-btn.active{background:rgba(255,255,255,0.9);border:1px solid var(--glass-border);box-shadow:inset 0 0 0 0.5px rgba(255,255,255,0.6)}
.chips .chip.active{border-color:var(--primary);color:var(--primary)}

/* Mobile responsiveness enhancements */
img,video{max-width:100%;height:auto}
@media (max-width:560px){
  .app-header h1{font-size:22px}
  .header-actions{flex-wrap:wrap;gap:6px}
  .filters{flex-wrap:wrap}
  .summary{grid-template-columns:1fr 1fr}
  .grid{grid-template-columns:1fr}
  .field--full{grid-column:1/2}
  .tx-item{grid-template-columns:1fr auto;align-items:flex-start}
  .tx-actions{grid-column:1/-1;justify-content:flex-end;flex-wrap:wrap}
  .calendar .cal-cell{min-height:56px}
  dialog.quick-form, .category-form{min-width:0;width:92vw}
  #settingsForm .grid{ display:block }
  #settingsForm .inline{ flex-wrap:wrap }
  #categoryBudgetList .inline{ gap:8px }
  #categoryBudgetList input[type="number"]{ width:120px }
}
/* iOS-like tighter mobile polish */
@media (max-width:560px){
  :root{ --button-height:48px; --button-px:16px; --radius:16px; --radius-lg:20px }
  .container{ padding:0 10px; gap:12px }
  .card{ padding:14px }
  h2{ font-size:17px }
  label{ font-size:13px }
  input,select{ padding:12px }
  /* Hide secondary actions to reduce crowding on small screens */
  #exportJsonBtn,.import-label,#syncBtn{ display:none }
  /* Filters stack nicely */
  .filters{ row-gap:6px }
  .filters input[type="search"], .filters select{ flex:1 1 100%; min-width:0 }
  /* List items spacing */
  .tx-item{ padding:14px; grid-template-columns:1fr auto }
  .tx-actions button{ min-width:0; padding:0 10px }
  /* Bottom tabs full width, iOS-like */
  .tabs.bottom{ left:0; transform:none; width:100%; justify-content:space-between; padding:0 8px }
}
@media (max-width:420px){
  .app-header h1{font-size:20px}
  button{height:42px}
  .summary{grid-template-columns:1fr}
  .tabs.bottom{bottom:max(56px, env(safe-area-inset-bottom))}
  .fab{bottom:calc(96px + env(safe-area-inset-bottom))}
}
